const STATE_MENU=0,STATE_TEAM_EDITOR=1,STATE_TEAM_EDITOR_INFO=2,STATE_BATTLE=3,STATE_BATTLE_MENU=4,STATE_TEAM_VIEW=5,STATE_UPGRADE=6,STATE_SETTINGS=7,STATE_SANDBOX=8,STATE_ACHIEVEMENT=9,STATE_TRAITS=10,BACKGROUND_MATRIX=0,BACKGROUND_ALIVE=1,ACTION_WALK=0,ACTION_ATTACK=1,UPGRADE_DAMAGE=2,UPGRADE_HEALTH=5,UPGRADE_AMMO=1,ATTACK_MELEE=0,ATTACK_AUTO=1,ATTACK_SEMI_AUTO=2,ATTACK_SHOTGUN=3,ATTACK_KAMIKAZE=4,ATTACK_LASER=5,ATTACK_EXPLOSIONS=6,ATTACK_SNIPER=7,WEAPON_NAME=["melee","auto","semi-auto","shotgun","suicide","laser","explosions","sniper"],GHOST_LENGTH=5,LASER_DURATION=3;STYLE_NORMAL=0,STYLE_BOLD=1,STYLE_ITALIC=2,STYLE_UPPERCASE=3,STYLE_UNDERLINE=4,STYLE_NAME=["normal","bold","italic","uppercase","underline"],ENEMY_TEAM="ENEMY",PLAYER_TEAM="PLAYER",SHADOW_GAP=4,STROKE_WEIGHT=4,GAME_TITLE="Letter Wars",NUMBERS=["1","2","3","4","5","6","7","8","9","0"],VOWELS=["a","e","i","o","u"],CONSONANTS=["b","c","d","f","g","h","j","k","l","m","n","p","q","r","s","t","v","w","x","y","z"],SPECIALS=["!","@","#","$","%","^","&","*","(",")","_","+","-","=","[","]","{","}","\\","|",";",":","'",'"',",",".","<",">","/","?","`","~"];let AVAILABLE_CHARACTERS,TEAM_SIZE,ENEMY_TEAM_SIZE,AVAILABLE_UPGRADES,entities=[],bullets=[],particles=[],team=[],team_battlefield=[],enemy_team=[],upgrades=[],IMAGES={},CURRENT_COLORS=0,VOLUME=.5,WAVE_QUANTITY=5,ACHIEVEMENTS_STATUS=[[!0,!0,!0,!0],[!0,!0,!0,!1],[!1,!1,!1,!1],[!1,!1,!1,!1]],ACHIEVEMENTS_UNLOCKED=[[!0,!0,!0,!0],[!0,!0,!0,!1],[!1,!1,!1,!1],[!1,!1,!1,!1]];function setup_values(){AVAILABLE_CHARACTERS=[...VOWELS],TEAM_SIZE=4,ENEMY_TEAM_SIZE=3,AVAILABLE_UPGRADES=[{buffs:{ammo:1}},{buffs:{damage:2}},{buffs:{max_health:5}},{buffs:{damage:1,max_health:2.5}},{weapon:2},{style:STYLE_BOLD},{style:STYLE_ITALIC},{style:STYLE_UPPERCASE},{style:STYLE_UNDERLINE}]}function get_trait(t){return VOWELS.includes(t)?"vowel":CONSONANTS.includes(t)?"consonant":NUMBERS.includes(t)?"number":"special"}function get_buff(t){return{vowel:{max_health:5},consonant:{max_health:2.5,damage:1},number:{damage:2},special:{ammo:1}}[t]}function get_team_word(){return team.map(t=>t.char).join("")}function count_traits(t){const e={};for(const s of t)null!=e[s.attributes.trait]?e[s.attributes.trait]+=1:e[s.attributes.trait]=1;return e}function setup_achievements(){setup_values();for(let t=0;t<ACHIEVEMENTS_UNLOCKED.length;t++)for(let e=0;e<ACHIEVEMENTS_UNLOCKED[t].length;e++)ACHIEVEMENTS_STATUS[t][e]&&change_achievement(t,e,ACHIEVEMENTS_STATUS[t][e]);if(team.length>TEAM_SIZE)for(;team.length>TEAM_SIZE;)team.splice(team.length-1,1);else for(;team.length<TEAM_SIZE;)team.push(new Char(PLAYER_TEAM,random(VOWELS)))}function change_achievement(t,e,s){if(0===t&&(s?TEAM_SIZE++:TEAM_SIZE--),1===t){let t=[];return 0===e&&(t=CONSONANTS),1===e&&(t=NUMBERS),2===e&&(t=SPECIALS),void(AVAILABLE_CHARACTERS=s?AVAILABLE_CHARACTERS.concat(t):AVAILABLE_CHARACTERS.filter(e=>t.includes(e)))}if(2===t){const t=[STYLE_ITALIC,STYLE_BOLD,STYLE_UPPERCASE,STYLE_UNDERLINE];return void(s?AVAILABLE_UPGRADES.push({style:t[e]}):AVAILABLE_UPGRADES=AVAILABLE_UPGRADES.filter(e=>JSON.stringify(e)!==JSON.stringify({style:t})))}if(3===t){const t=[7,4,6,5];return void(s?AVAILABLE_UPGRADES.push({weapon:t[e]}):AVAILABLE_UPGRADES=AVAILABLE_UPGRADES.filter(e=>JSON.stringify(e)!==JSON.stringify({weapon:t})))}}function setup_colors(t){t&&(CURRENT_COLORS=(CURRENT_COLORS+1)%COLORS.length);const e=COLORS[CURRENT_COLORS];MAIN_COLOR=e.main,MAIN_COLOR_SHADOW=e.shadow,DEAD_COLOR=e.dead,UPGRADE_COLOR=e.upgrade,SECOND_COLOR=e.second,TEAM_COLOR=e.team,BULLET_COLOR=e.bullet,BULLET_COMPLEMENTARY_COLOR=e.bullet_complementary}function isMobile(){const t=navigator.userAgent.toLowerCase();return/iphone|ipod|android|windows phone/.test(t)}function small_screen(){return width<280||height<600}setup_values();let BUTTON_WIDTH=250,BUTTON_HEIGHT=100,SQUARE_BUTTON=50,CHARACTER_SIZE=32,SMALL_SCREEN=!1;isMobile()&&(BUTTON_WIDTH=200,BUTTON_HEIGHT=100,SQUARE_BUTTON=50,CHARACTER_SIZE*=.7);let game,WINDOW_TOP,WINDOW_BOTTOM,WINDOW_LEFT,WINDOW_RIGHT,MOUSE_X,MOUSE_Y,MAIN_COLOR,MAIN_COLOR_SHADOW,MAIN_COLOR_DARKER,SECOND_COLOR,TEAM_COLOR,BULLET_COLOR,BULLET_COMPLEMENTARY_COLOR,COLORS,MOBILE,framerateP,MIN_VEL=1;function add(t,e,s){return parseFloat((parseFloat(t)+parseFloat(e)).toFixed(s))}function sub(t,e,s){return parseFloat((parseFloat(t)-parseFloat(e)).toFixed(s))}function mul(t,e,s){return parseFloat((parseFloat(t)*parseFloat(e)).toFixed(s))}function random_signed(){return Math.random()-.5}function random_bool(){return 0>=Math.random()-.5}function random_sign(){return random_bool()?-1:1}function easeInQuad(t){return t*t}function easeInExpo(t){return 0===t?0:Math.pow(2,10*t-10)}function easeOutElastic(t){const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}function distSquared(t,e,s,i){let a=s-t,r=i-e;return a*a+r*r}function extend_target(t,e,s){const i=atan2(e.y-t.y,e.x-t.x);return createVector(t.x+cos(i)*s,t.y+sin(i)*s)}function point_line_dist(t,e,s){return abs((s.y-e.y)*t.x-(s.x-e.x)*t.y+s.x*e.y-s.y*e.x)/p5.Vector.dist(e,s)}class Screen{constructor(){this.images={},this.buttons=[]}load(t){for(const e in this.images)"src"in this.images[e]&&(this.images[e].img=loadImage(`${t}/${this.images[e].src}`))}setup(){this.setup_ui()}setup_ui(){}draw(){for(const t of Object.values(this.buttons))t.draw();this.draw_background()}update(){for(const t of this.buttons)t.update()}resize(){}mouseClicked(){}mouseMoved(){for(const t of Object.values(this.buttons))t.mouseMoved()}touchStarted(){for(const t of Object.values(this.buttons))t.touchStarted()}touchMoved(){for(const t of Object.values(this.buttons))t.touchMoved()}touchEnded(){for(const t of Object.values(this.buttons))t.touchEnded();return this.mouseClicked()}draw_background(){}}class Achievement extends Screen{constructor(){super(),this.background=random([0,1]),this.btn_offset=MOBILE?1.3:1.6,this.images={"-1":{src:"achievements/locked.png",img:null},0:{src:"achievements/beat_the_game_1.png",img:null},1:{src:"achievements/beat_the_game_2.png",img:null},2:{src:"achievements/beat_the_game_3.png",img:null},3:{src:"achievements/beat_the_game_4.png",img:null},4:{src:"achievements/beat_the_game_consonant.png",img:null},5:{src:"achievements/beat_the_game_number.png",img:null},6:{src:"achievements/beat_the_game_special.png",img:null},7:{src:"achievements/beat_the_game_angel.png",img:null},8:{img:null},9:{img:null},10:{img:null},11:{img:null},12:{img:null},13:{img:null},14:{img:null},15:{img:null}},this.achievements=[["0","1","2","3"],["4","5","6","7"],["8","9","10","11"],["12","13","14","15"]],this.achievement_name="",this.achievement_description=""}load(t,e){super.load(t);for(let t=0;t<e.length;t++)this.images[str(t+8)].img=e[t]}setup_ui(){this.return=new TextButton("<",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.buttons=[];const t=SQUARE_BUTTON;for(let e=0;e<this.achievements.length;e++){const s=-t*this.btn_offset*2+t*this.btn_offset*e;for(let i=0;i<this.achievements[e].length;i++){const a=-.5*this.achievements[e].length*t*this.btn_offset+.8*t+t*this.btn_offset*i,r=ACHIEVEMENTS_UNLOCKED[e][i]?this.images[this.achievements[e][i]].img:this.images[-1].img,h=new ImageButton(r,createVector(a,s),createVector(t,t),ACHIEVEMENTS_STATUS[e][i]);this.buttons.push(h)}}this.buttons.push(this.return),this.resize()}draw(){super.draw(),push(),textSize(1.5*CHARACTER_SIZE),text("Achievements",0,WINDOW_TOP+height/6),pop(),null!==this.achievement_name&&null!==this.achievement_description&&(push(),textSize(1.2*CHARACTER_SIZE),text(this.achievement_name,0,WINDOW_BOTTOM-height/6),textSize(.8*CHARACTER_SIZE),text(this.achievement_description,0,WINDOW_BOTTOM-height/10),pop())}mouseClicked(){if(this.return.hover())return 0;const t=ceil((MOUSE_Y+SQUARE_BUTTON*this.btn_offset*1.5)/(SQUARE_BUTTON*this.btn_offset)),e=ceil((MOUSE_X+SQUARE_BUTTON*this.btn_offset)/(SQUARE_BUTTON*this.btn_offset));if(e<0||t<0||t>=this.achievements.length||e>=this.achievements[0].length)return;let s=t*this.achievements.length+e;return this.buttons[s].hover()&&ACHIEVEMENTS_UNLOCKED[t][e]&&this.buttons[s].hover()?(this.buttons[s].active=!this.buttons[s].active,void(ACHIEVEMENTS_STATUS[t][e]=this.buttons[s].active)):void 0}mouseMoved(){super.mouseMoved();const t=ceil((MOUSE_Y+SQUARE_BUTTON*this.btn_offset*1.5)/(SQUARE_BUTTON*this.btn_offset)),e=ceil((MOUSE_X+SQUARE_BUTTON*this.btn_offset)/(SQUARE_BUTTON*this.btn_offset));if(e<0||t<0||t>=this.achievements.length||e>=this.achievements[0].length)return;let s=t*this.achievements.length+e;return this.buttons[s].hover()?(this.achievement_name=this.get_achievement_name(t,e),ACHIEVEMENTS_UNLOCKED[t][e]?void(this.achievement_description=this.get_achievement_description(t,e)):void(this.achievement_description=this.get_locked_achievement_description(t,e))):void 0}touchStarted(){super.touchStarted(),this.mouseMoved()}touchMoved(){this.mouseMoved(),super.touchMoved()}touchEnded(){return this.mouseMoved(),super.touchEnded()}resize(){let t=0;const e=SQUARE_BUTTON;for(let s=0;s<this.achievements.length;s++){const i=-e*this.btn_offset*2+e*this.btn_offset*s;for(let a=0;a<this.achievements[s].length;a++){const r=-.5*this.achievements[s].length*e*this.btn_offset+.8*e+e*this.btn_offset*a;this.buttons[t].resize(r,i),t++}}this.return.resize(WINDOW_LEFT+.5*SQUARE_BUTTON+20,WINDOW_TOP+.5*SQUARE_BUTTON+20)}draw_background(){}get_locked_achievement_description(t,e){return[["Beat the game","Beat the game 2x","Beat the game 3x","Beat the game 4x"],["Beat the game using\nvowels only","Beat the game using\nconsonants only","Beat the game using\nnumbers only","Beat the game using\nspecial only"],['Beat the game with\nthe team as "italic"','Beat the game with\nthe team as "bold"','Beat the game with\nthe team as "upper"','Beat the game with\nthe team as "under"'],['Beat the game with\nthe team as "sniper"','Beat the game with\nthe team as "kamikaze"','Beat the game with\nthe team as "bomb"','Beat the game with\nthe team as "laser"']][t][e]}get_achievement_description(t,e){return[["Team size +","Team size +","Team size +","Team size +"],["Unlock consonants\n(Attack +)","Unlock numbers\n(Attack +, Health +)","Unlock special\n(Ammo +)","Unlock angel"],["Unlock style italic","Unlock style bold","Unlock style uppercase","Unlock style underline"],["Unlock weapon sniper","Unlock weapon kamikaze","Unlock weapon explosions","Unlock weapon laser"]][t][e]}get_achievement_name(t,e){return[["Win","Win (2x)","Win (3x)","Win (4x)"],["Vowels","Consonants","Numbers","Specials"],["Italic","Bold","Uppercase","Underline"],["Sniper","Kamikaze","Explosions","Laser"]][t][e]}verify_achievements(){const t=[],e=Object.keys(count_traits(team));for(let e=0;e<ACHIEVEMENTS_UNLOCKED[0].length;e++)if(!ACHIEVEMENTS_UNLOCKED[0][e]){let s="Beat the game";0!==e&&(s=`Beat the game x${e+1}`),t.push(new Popup(s,this.images[str(4+e)].img)),ACHIEVEMENTS_UNLOCKED[0][e]=!0,ACHIEVEMENTS_STATUS[0][e]=!0;break}if(1===e.length)switch(e[0]){case"vowel":if(ACHIEVEMENTS_UNLOCKED[1][0])break;t.push(new Popup("Vowels",this.images[0].img)),ACHIEVEMENTS_UNLOCKED[1][0]=!0,ACHIEVEMENTS_STATUS[1][0]=!0;break;case"consonant":if(ACHIEVEMENTS_UNLOCKED[1][1])break;t.push(new Popup("Consonants",this.images[1].img)),ACHIEVEMENTS_UNLOCKED[1][1]=!0,ACHIEVEMENTS_STATUS[1][1]=!0;break;case"number":if(ACHIEVEMENTS_UNLOCKED[1][2])break;t.push(new Popup("Numbers",this.images[2].img)),ACHIEVEMENTS_UNLOCKED[1][2]=!0,ACHIEVEMENTS_STATUS[1][2]=!0;break;case"special":if(ACHIEVEMENTS_UNLOCKED[1][3])break;t.push(new Popup("Specials",this.images[3].img)),ACHIEVEMENTS_UNLOCKED[1][3]=!0,ACHIEVEMENTS_STATUS[1][3]=!0}const s=get_team_word();return ACHIEVEMENTS_UNLOCKED[2][0]||"italic"!==s?ACHIEVEMENTS_UNLOCKED[2][1]||"bold"!==s?ACHIEVEMENTS_UNLOCKED[2][2]||"upper"!==s?ACHIEVEMENTS_UNLOCKED[2][3]||"under"!==s||(ACHIEVEMENTS_UNLOCKED[2][3]=!0,ACHIEVEMENTS_STATUS[2][3]=!0,t.push(new Popup("Underline",this.images[0].img))):(ACHIEVEMENTS_UNLOCKED[2][2]=!0,ACHIEVEMENTS_STATUS[2][2]=!0,t.push(new Popup("Uppercase",this.images[0].img))):(ACHIEVEMENTS_UNLOCKED[2][1]=!0,ACHIEVEMENTS_STATUS[2][1]=!0,t.push(new Popup("Bold",this.images[0].img))):(ACHIEVEMENTS_UNLOCKED[2][0]=!0,ACHIEVEMENTS_STATUS[2][0]=!0,t.push(new Popup("Italic",this.images[0].img))),ACHIEVEMENTS_UNLOCKED[3][0]||"guide"!==s?ACHIEVEMENTS_UNLOCKED[2][1]||""!==s?ACHIEVEMENTS_UNLOCKED[2][2]||"bomb"!==s?ACHIEVEMENTS_UNLOCKED[2][3]||"laser"!==s||(ACHIEVEMENTS_UNLOCKED[3][3]=!0,ACHIEVEMENTS_STATUS[3][3]=!0,t.push(new Popup("",this.images[0].img))):(ACHIEVEMENTS_UNLOCKED[3][2]=!0,ACHIEVEMENTS_STATUS[3][2]=!0,t.push(new Popup("",this.images[0].img))):(ACHIEVEMENTS_UNLOCKED[3][1]=!0,ACHIEVEMENTS_STATUS[3][1]=!0,t.push(new Popup("",this.images[0].img))):(ACHIEVEMENTS_UNLOCKED[3][0]=!0,ACHIEVEMENTS_STATUS[3][0]=!0,t.push(new Popup("angel",this.images[0].img))),t}new_achievement(){const t={};for(const e of team)null!=t[e.char]?t[e.char]+=1:t[e.char]=1}}class Battle extends Screen{constructor(){super(),this.reset(),this.layer=null,this.layer_img=null,this.wave=0}setup(){super.setup(),bullets=[],particles=[],this.setup_entities()}setup_ui(){this.pause_btn=new TextButton("⏸",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.view_team_btn=new TextButton("⚔",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.buttons=[],this.buttons.push(this.pause_btn),this.buttons.push(this.view_team_btn),this.layer=createFramebuffer(),this.layer.begin(),background(MAIN_COLOR),this.layer.end(),this.layer_img=this.layer.get(),this.resize()}setup_entities(){entities=[],team_battlefield=[],this.setup_enemies();const t=[];for(const e of team)t.push(new Char(PLAYER_TEAM,e.char));const e=enemy_team.slice();t.forEach(t=>t.setup()),e.forEach(t=>t.setup()),this.apply_buffs(t),this.apply_buffs(e),this.apply_upgrades(t,upgrades),t.forEach(t=>t.restore()),e.forEach(t=>t.restore()),this.setup_pos(t),this.setup_pos(e),team_battlefield=t}setup_enemies(){enemy_team=[];let t=[...VOWELS],e=TEAM_SIZE-3+this.wave;ACHIEVEMENTS_UNLOCKED[1][0]&&ACHIEVEMENTS_STATUS[1][0]&&(t=t.concat(CONSONANTS)),ACHIEVEMENTS_UNLOCKED[1][1]&&ACHIEVEMENTS_STATUS[1][1]&&(t=t.concat(NUMBERS)),ACHIEVEMENTS_UNLOCKED[1][2]&&ACHIEVEMENTS_STATUS[1][2]&&(t=t.concat(SPECIALS));for(const s of t.sort(()=>.5-Math.random()).slice(0,e))enemy_team.push(new Char(ENEMY_TEAM,s));if(!ACHIEVEMENTS_UNLOCKED[1][3]&&this.wave===WAVE_QUANTITY-1){const e=Object.keys(count_traits(team));1===e.length&&"special"===e[0]&&(enemy_team=[],enemy_team.push(new Char(ENEMY_TEAM,random(t))),enemy_team.push(new Boss(ENEMY_TEAM,"c")),enemy_team.push(new Char(ENEMY_TEAM,random(t))))}enemy_team.push(new Boss(ENEMY_TEAM,"@"));const s=get_team_word();if("italic"===s)for(const t of enemy_team)t.attributes.style=STYLE_ITALIC;else if("bold"===s)for(const t of enemy_team)t.attributes.style=STYLE_BOLD;else if("upper"===s)for(const t of enemy_team)t.attributes.style=STYLE_UPPERCASE;else if("under"===s)for(const t of enemy_team)t.attributes.style=STYLE_UNDERLINE;if("sniper"===s)for(const t of enemy_team)t.attributes.weapon=7;else if("kamikaze"===s)for(const t of enemy_team)t.attributes.weapon=4;else if("bomb"===s)for(const t of enemy_team)t.attributes.weapon=6;else if("laser"===s)for(const t of enemy_team)t.attributes.weapon=5}setup_pos(t){const e={vowel:0*CHARACTER_SIZE,consonant:2*CHARACTER_SIZE,number:4*CHARACTER_SIZE,special:6*CHARACTER_SIZE},s=t[0].attributes.team===PLAYER_TEAM,i=width/(t.length+1);t.forEach((a,r)=>{const h=a.attributes.trait;a.attributes.pos=createVector(WINDOW_LEFT+(r+1)*i,(.25*height+e[h])*(s?-1:1)),entities.push(t[r])})}apply_buffs(t){const e=count_traits(t);for(const s in e){const i=get_buff(s);for(const a in i)for(const r of t)r.attributes.trait==s&&(r.attributes.upgrades[a]+=i[a]*min(e[s],3))}}apply_upgrades(t,e){for(const s of e)if("style"in s)t.forEach(t=>{t.attributes.trait==s.trait&&(t.attributes.style=s.style)});else if("weapon"in s)t.forEach(t=>{t.attributes.trait==s.trait&&(t.attributes.weapon=s.weapon)});else for(const e in s.buffs)for(const i of t)i.attributes.trait==s.trait&&(i.attributes.upgrades[e]+=s.buffs[e])}mouseClicked(){if(this.finish)return this.winner===ENEMY_TEAM?1:this.winner===PLAYER_TEAM?this.wave===WAVE_QUANTITY?9:(this.start=!1,6):void 0;if(!this.start)return this.start=!0,void(this.pause=!1);for(const t of team)if(t.mouseClicked())return;return!this.pause&&this.pause_btn.hover()?(this.freeze(),this.pause=!0,4):!this.pause&&this.view_team_btn.hover()?(this.freeze(),this.pause=!0,5):void 0}draw(){this.pause?image(this.layer_img,.5*-this.layer_img.width,.5*-this.layer_img.height):this.draw_battlefield(),super.update(),this.finish?this.draw_finish():this.start?this.pause||this.finished():this.draw_wave()}update(){if(!this.pause){for(const t of entities)t.update();for(const t of bullets)t.update();for(const t of particles)t.update()}}resize(){this.view_team_btn.resize(WINDOW_LEFT+25+20,WINDOW_TOP+25+20),this.pause_btn.resize(WINDOW_LEFT+50+25+40,WINDOW_TOP+25+20)}freeze(){this.layer.begin(),background(MAIN_COLOR),this.draw_battlefield(),filter(BLUR,2),this.layer.end(),this.layer_img=this.layer.get()}draw_wave(){text(`Wave ${this.wave+1}`,0,0)}draw_finish(){text(this.winner,0,0)}draw_battlefield(){for(const t of bullets)t.draw();super.draw();for(const t of entities)t.draw();for(const t of particles)if(t.draw(),t.finished()){const e=particles.indexOf(t);e>-1&&particles.splice(e,1)}}finished(){if(0==entities.length)return;let t=null;for(const e of entities)if(null!=t){if(e.attributes.team!=t)return}else t=e.attributes.team;this.wave++,this.pause=!0,this.start=!1,this.finish=!0,this.winner=t,team.forEach(t=>t.restore()),this.freeze()}reset(){this.pause=!0,this.start=!1,this.finish=!1,this.winner=null}}class BattleMenu extends Screen{constructor(){super()}setup_ui(){this.resume=new TextButton("Resume",{x:0,y:.25*-BUTTON_WIDTH},{x:BUTTON_WIDTH,y:BUTTON_HEIGHT}),this.exit=new TextButton("Exit",{x:0,y:.25*-BUTTON_WIDTH},{x:BUTTON_WIDTH,y:BUTTON_HEIGHT}),this.buttons=[],this.buttons.push(this.resume),this.buttons.push(this.exit),this.resize()}resize(){this.resume.resize(0,.8*-BUTTON_HEIGHT),this.exit.resize(0,.8*BUTTON_HEIGHT)}draw(){this.draw_title();for(const t of Object.values(this.buttons))t.draw()}mouseClicked(){return this.resume.hover()?3:this.exit.hover()?0:void 0}draw_title(){push(),textSize(2*CHARACTER_SIZE),text("Paused",0,-250),pop()}}class Menu extends Screen{constructor(){super(),this.images={achievement:{src:"icons/achievements.png",img:null},social:{src:"icons/social.png",img:null}},this.off_y,this.delay=.1,this.current_delay=0}setup(){switch(this.background=random([0,1]),this.off_y=height/6,super.setup(),this.background){case 0:this.matrix=[];let t=[...AVAILABLE_CHARACTERS];const e=isMobile()?10:20;t.length>e&&(shuffle(t,!0),t=t.slice(0,e));for(const e of t)this.matrix.push({char:e,alpha:255,delay:random(0,4),pos:createVector(random(WINDOW_LEFT,WINDOW_RIGHT),WINDOW_TOP-CHARACTER_SIZE),vel:createVector(0,0),rot:0,rot_vel:random(-QUARTER_PI/4,QUARTER_PI/4)});break;case 1:this.title=[];const s=GAME_TITLE.split("");for(let t=0;t<s.length;t++){const e=new ViewChar(-1,s[t]);e.setup(),e.attributes.pos=createVector(-GAME_TITLE.length*CHARACTER_SIZE*.5+t*CHARACTER_SIZE,WINDOW_TOP+1*this.off_y),this.title.push(e)}}}setup_ui(){this.achievement=new ImageButton(this.images.achievement.img,{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.social=new ImageButton(this.images.social.img,{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.new_game=new TextButton("Start",{x:0,y:0},{x:BUTTON_WIDTH,y:BUTTON_HEIGHT}),this.sandbox=new TextButton("Sandbox",{x:0,y:0},{x:BUTTON_WIDTH,y:BUTTON_HEIGHT}),this.settings=new TextButton("Settings",{x:0,y:0},{x:BUTTON_WIDTH,y:BUTTON_HEIGHT}),this.buttons=[],this.buttons.push(this.new_game),this.buttons.push(this.sandbox),this.buttons.push(this.settings),this.buttons.push(this.achievement),this.buttons.push(this.social),this.resize()}update(){switch(super.update(),this.background){case 0:this.update_matrix();break;case 1:for(const t of this.title)t.update()}}mouseClicked(){return this.new_game.hover()?1:this.achievement.hover()?9:this.sandbox.hover()?8:this.settings.hover()?7:void 0}resize(){this.achievement.resize(WINDOW_LEFT+.5*SQUARE_BUTTON+20,WINDOW_BOTTOM-25-20),this.social.resize(WINDOW_RIGHT-.5*SQUARE_BUTTON-20,WINDOW_BOTTOM-25-20),this.new_game.resize(0,WINDOW_TOP+2.5*this.off_y),this.sandbox.resize(0,WINDOW_TOP+3.5*this.off_y),this.settings.resize(0,WINDOW_TOP+4.5*this.off_y)}draw_background(){switch(this.background){case 0:this.draw_title(),this.draw_matrix();break;case 1:for(const t of this.title)t.draw()}this.current_delay+=deltaTime/1e3,this.current_delay>this.delay&&(this.current_delay=0,mouseIsPressed&&this.interact())}draw_title(){push(),textSize(2*CHARACTER_SIZE),text(GAME_TITLE,0,WINDOW_TOP+1*this.off_y),pop()}draw_matrix(){push();for(const t of this.matrix)SECOND_COLOR.setAlpha(t.alpha),push(),translate(t.pos.x,t.pos.y),rotate(t.rot),text(t.char,0,0),pop();SECOND_COLOR.setAlpha(255),pop()}update_matrix(){for(const t of this.matrix)t.delay>0?t.delay-=deltaTime/1e3:(t.pos.add(t.vel.copy().mult(deltaTime/10)),t.vel.y+=.1,t.rot+=t.rot_vel,t.alpha=(.5*height-t.pos.y)/height*255,(t.pos.x<WINDOW_LEFT||t.pos.x>WINDOW_RIGHT)&&(t.vel.x=-t.vel.x),t.pos.y>WINDOW_BOTTOM&&(t.pos.x=random(WINDOW_LEFT,WINDOW_RIGHT),t.pos.y=WINDOW_TOP-CHARACTER_SIZE,t.vel.x=0,t.vel.y=0,t.rot=0,t.alpha=255))}interact(){const t=createVector(MOUSE_X,MOUSE_Y),e=0===this.background;let s=e?this.matrix:this.title;for(const i of s){const s=e?i.pos:i.attributes.pos;distSquared(t.x,t.y,s.x,s.y)>1e4||(e?i.vel.add(t.copy().sub(s).normalize().mult(-5)):i.attributes.vel.add(t.copy().sub(s).normalize().mult(-10)))}}}class SandBox extends Battle{constructor(){super()}setup(){super.setup(),this.setup_sandbox_buttons()}setup_sandbox_buttons(){}mouseClicked(){const t=new Boss(random(0,1),"a");return t.setup(),t.attributes.pos=createVector(MOUSE_X,MOUSE_Y),entities.push(t),this.pause_btn.hover()?(this.pause=!0,4):this.finish&&this.winner==ENEMY_TEAM?1:this.finish&&this.winner==PLAYER_TEAM?6:void 0}finished(){}}class Settings extends Screen{constructor(){super(),this.sliders=[]}setup_ui(){this.volume=new Slider("Volume",{x:0,y:0},BUTTON_WIDTH,VOLUME),this.sliders=[],this.sliders.push(this.volume),this.change_color=new TextButton("Game color",{x:0,y:0},{x:BUTTON_WIDTH,y:BUTTON_HEIGHT}),this.return=new TextButton("<",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.buttons=[],this.buttons.push(this.change_color),this.buttons.push(this.return),this.resize()}draw(){super.draw(),this.draw_title();for(const t of Object.values(this.sliders))t.draw()}mouseClicked(){if(this.sliders[0].hover()&&(this.sliders[0].mouseClicked(),VOLUME=this.sliders[0].value,game.set_volumes(),game.sounds.dash.play()),this.change_color.hover()&&(setup_colors(!0),stroke(SECOND_COLOR),fill(SECOND_COLOR),this.setup()),this.return.hover())return 0}update(){super.update();for(const t of this.buttons)t.update();for(const t of this.sliders)t.update()}resize(){this.volume.resize(0,-150),this.change_color.resize(0,0),this.return.resize(WINDOW_LEFT+.5*SQUARE_BUTTON+20,WINDOW_TOP+.5*SQUARE_BUTTON+20)}draw_title(){push(),textSize(1.5*CHARACTER_SIZE),text("Settings",0,WINDOW_TOP+height/6),pop()}}class TeamEditor extends Screen{constructor(){super(),this.index_carrousel=0,this.images={traits:{src:"icons/traits.png",img:null}}}setup_ui(){this.team_carrousel=new ViewCarrousel(createVector(0,0),team,10*CHARACTER_SIZE),this.carrousel_height=.25*height,this.vowel_carrousel=new EditorCarrousel(createVector(0,0),VOWELS,3*CHARACTER_SIZE),this.consonant_carrousel=new EditorCarrousel(createVector(0,0),CONSONANTS,3*CHARACTER_SIZE),this.special_carrousel=new EditorCarrousel(createVector(0,0),SPECIALS,3*CHARACTER_SIZE),this.number_carrousel=new EditorCarrousel(createVector(0,0),NUMBERS,3*CHARACTER_SIZE),this.available_carrousel={vowel:this.vowel_carrousel},ACHIEVEMENTS_STATUS[1][0]&&(this.available_carrousel.consonant=this.consonant_carrousel),ACHIEVEMENTS_STATUS[1][1]&&(this.available_carrousel.number=this.number_carrousel),ACHIEVEMENTS_STATUS[1][2]&&(this.available_carrousel.special=this.special_carrousel),this.current_carrousel=this.vowel_carrousel,this.return=new TextButton("<",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.traits=new ImageButton(this.images.traits.img,{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.info=new TextButton("?",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.mid_height=.6*this.carrousel_height,this.next_carrousel=new TextButton(">",createVector(0,0),createVector(textWidth(">")+20,SQUARE_BUTTON),1!==Object.keys(this.available_carrousel).length),this.previous_carrousel=new TextButton("<",createVector(0,0),createVector(textWidth("<")+20,SQUARE_BUTTON),1!==Object.keys(this.available_carrousel).length),this.bottom_height=1.6*this.carrousel_height,MOBILE?this.ready=new TextButton("Ready",{x:0,y:0},{x:300,y:75}):(this.choose=new TextButton("Choose",{x:0,y:0},{x:150,y:75}),this.ready=new TextButton("Ready",{x:0,y:0},{x:150,y:75})),this.buttons=[],this.buttons.push(this.return),this.buttons.push(this.traits),this.buttons.push(this.info),MOBILE||this.buttons.push(this.choose),this.buttons.push(this.ready),this.buttons.push(this.next_carrousel),this.buttons.push(this.previous_carrousel),this.resize()}draw(){super.draw(),this.draw_carrousel()}update(){super.update(),this.team_carrousel.update(),this.current_carrousel.update()}mouseClicked(){if(this.return.hover())return 0;if(this.traits.hover())return 10;if(this.info.hover())return 2;if(this.ready.hover())return 3;if(!MOBILE&&this.choose.hover()){const t=new Char(PLAYER_TEAM,this.current_carrousel.current_char());return void(team[round(this.team_carrousel.index)]=t)}const t=Object.keys(this.available_carrousel);return this.next_carrousel.hover()?(this.index_carrousel=(this.index_carrousel+1)%t.length,void(this.current_carrousel=this.available_carrousel[t[this.index_carrousel]])):this.previous_carrousel.hover()?(this.index_carrousel=(this.index_carrousel-1)%t.length,this.index_carrousel<0&&(this.index_carrousel=t.length-1),void(this.current_carrousel=this.available_carrousel[t[this.index_carrousel]])):void 0}touchStarted(){super.touchStarted(),this.team_carrousel.touchStarted(),this.current_carrousel.touchStarted()}touchMoved(){super.touchMoved(),this.team_carrousel.touchMoved(),this.current_carrousel.touchMoved()}touchEnded(){if(this.team_carrousel.touchEnded(),!this.current_carrousel.touchEnded())return super.touchEnded();if(this.team_carrousel.hover()){const t=new Char(PLAYER_TEAM,this.current_carrousel.current_char());team[round(this.team_carrousel.index)]=t}}resize(){this.team_carrousel.resize(0,.125*-height),this.vowel_carrousel.resize(0,this.carrousel_height),this.consonant_carrousel.resize(0,this.carrousel_height),this.special_carrousel.resize(0,this.carrousel_height),this.number_carrousel.resize(0,this.carrousel_height),this.return.resize(WINDOW_LEFT+.5*SQUARE_BUTTON+20,WINDOW_TOP+25+20),this.traits.resize(WINDOW_RIGHT-1.5*SQUARE_BUTTON-40,WINDOW_TOP+25+20),this.info.resize(WINDOW_RIGHT-.5*SQUARE_BUTTON-20,WINDOW_TOP+25+20),this.mid_height=.6*this.carrousel_height,this.next_carrousel.resize(150,this.mid_height),this.previous_carrousel.resize(-150,this.mid_height),this.bottom_height=1.6*this.carrousel_height,MOBILE?this.ready.resize(0,this.bottom_height):(this.choose.resize(-100,this.bottom_height),this.ready.resize(100,this.bottom_height))}draw_carrousel(){this.team_carrousel.draw(),this.current_carrousel.draw();const t=Object.keys(this.available_carrousel);push(),noFill(),translate(0,0,-5),stroke(MAIN_COLOR_SHADOW),rect(-textWidth("consonant")/2-20+SHADOW_GAP,this.mid_height-25+SHADOW_GAP,textWidth("consonant")+40,50),translate(0,0,5),stroke(SECOND_COLOR),rect(-textWidth("consonant")/2-20-SHADOW_GAP,this.mid_height-25-SHADOW_GAP,textWidth("consonant")+40,50),fill(SECOND_COLOR),text(t[this.index_carrousel],0-SHADOW_GAP,this.mid_height-2*SHADOW_GAP),pop()}}class TeamView extends Screen{constructor(){super(),this.current_char=null}setup_ui(){this.team_carrousel=new ViewCarrousel(createVector(0,0),team_battlefield,10*CHARACTER_SIZE),this.current_char=this.team_carrousel.current_char(),this.carrousel_height=.25*height,this.resume_btn=new TextButton("▶",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.buttons=[],this.buttons.push(this.resume_btn),this.resize(),this.layer=createFramebuffer(),this.layer_img=null}draw(){super.draw(),this.team_carrousel.draw(),null===this.layer_img&&this.freeze(),image(this.layer_img,-.5*this.layer_img.width,-.5*this.layer_img.height)}update(){super.update(),this.team_carrousel.update()}mouseClicked(){if(this.resume_btn.hover())return 3}mouseMoved(){super.mouseMoved(),this.team_carrousel.mouseMoved(),this.current_char!==this.team_carrousel.current_char()&&(this.current_char=this.team_carrousel.current_char(),this.freeze())}touchStarted(){super.touchStarted(),this.team_carrousel.touchStarted()}touchMoved(){super.touchMoved(),this.team_carrousel.touchMoved(),this.current_char!==this.team_carrousel.current_char()&&(this.current_char=this.team_carrousel.current_char(),this.freeze())}touchEnded(){return this.team_carrousel.touchEnded(),super.touchEnded()}resize(){this.team_carrousel.resize(0,.125*-height),this.resume_btn.resize(WINDOW_LEFT+.5*SQUARE_BUTTON+20,WINDOW_TOP+25+20)}draw_char_info(){const t=this.team_carrousel.current_char(),e=.5*-textWidth("Max Health: 10 + 10 2"),s=MOBILE?CHARACTER_SIZE:.5*CHARACTER_SIZE;push(),fill(MAIN_COLOR),rect(e-s,this.carrousel_height-160-.5*CHARACTER_SIZE-s,2*abs(e-s),200+CHARACTER_SIZE+2*s),pop(),this.draw_attributes("Damage",t.attributes.damage,t.attributes.upgrades.damage,{x:e,y:this.carrousel_height-160},t.attributes.style===STYLE_BOLD?STYLE_BOLD:STYLE_NORMAL),this.draw_attributes("Weapon",WEAPON_NAME[t.attributes.weapon],null,{x:e,y:this.carrousel_height-120}),this.draw_attributes("Ammo",t.attributes.ammo,t.attributes.upgrades.ammo,{x:e,y:this.carrousel_height-80}),this.draw_attributes("Health",t.attributes.current_health,null,{x:e,y:this.carrousel_height-40}),this.draw_attributes("Max Health",t.attributes.max_health,t.attributes.upgrades.max_health,{x:e,y:this.carrousel_height},t.attributes.style===STYLE_UPPERCASE?STYLE_UPPERCASE:STYLE_NORMAL),this.draw_attributes("Trait",t.attributes.trait,null,{x:e,y:this.carrousel_height+40})}draw_attributes(t,e,s,i,a=STYLE_NORMAL){let r=`${t}: ${e}`;push(),textAlign(LEFT),text(r,i.x,i.y),null!==s?(fill(UPGRADE_COLOR),text(` + ${s}`,i.x+textWidth(r),i.y),a!==STYLE_NORMAL?(r+=` + ${s}`,translate(i.x+textWidth(r),i.y-1.5*CHARACTER_SIZE),rotate(QUARTER_PI),fill(MAIN_COLOR_SHADOW),a===STYLE_BOLD?(text("1.5x",SHADOW_GAP,SHADOW_GAP),fill(SECOND_COLOR),text("1.5x",0,0)):a===STYLE_UPPERCASE&&(text("2.0x",SHADOW_GAP,SHADOW_GAP),fill(SECOND_COLOR),text("2.0x",0,0)),pop()):pop()):pop()}freeze(){this.layer.begin(),clear(),this.draw_char_info(),this.layer.end(),this.layer_img=this.layer.get()}}class TeamViewEditor extends TeamView{setup_ui(){this.return_btn=new TextButton("<",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON}),super.setup_ui(),this.buttons=[],this.buttons.push(this.return_btn),this.resize(),this.layer=createFramebuffer(),this.layer_img=null}mouseClicked(){if(this.return_btn.hover())return 1}resize(){this.team_carrousel.resize(0,.125*-height),this.return_btn.resize(WINDOW_LEFT+.5*SQUARE_BUTTON+20,WINDOW_TOP+25+20)}}class Traits extends Screen{constructor(){super()}setup_ui(){this.return=new TextButton("<",{x:0,y:0},{x:SQUARE_BUTTON,y:SQUARE_BUTTON},!0),this.buttons=[],this.buttons.push(this.return),this.resize()}draw(){super.draw(),this.draw_traits_info()}mouseClicked(){if(this.return.hover())return 0}resize(){this.return.resize(WINDOW_LEFT+25+20,WINDOW_TOP+25+20)}draw_traits_info(){push(),noFill(),translate(0,0,-5),stroke(MAIN_COLOR_SHADOW),translate(-.75*width*.5,-.75*height*.5),rect(SHADOW_GAP,SHADOW_GAP,.75*width,.75*height),translate(0,0,5),stroke(SECOND_COLOR),rect(-SHADOW_GAP,-SHADOW_GAP,.75*width,.75*height);const t=["vowel","consonant","number","special"];noStroke(),fill(SECOND_COLOR),textAlign(LEFT),translate(0,.75*height*.5-4*t.length*CHARACTER_SIZE*.5);for(let e=0;e<t.length;e++){translate(0,CHARACTER_SIZE),text(t[e],.1*width,0);for(let s=0;s<3;s++)translate(0,CHARACTER_SIZE),text(JSON.stringify(get_buff(t[e],s)),.2*width,0)}pop()}}class Upgrade extends Screen{constructor(){super(),this.upgrades=[],this.images={ammo_up:{src:"upgrades/ammo_up.png",img:null},damage_up:{src:"upgrades/damage_up.png",img:null},health_up:{src:"upgrades/health_up.png",img:null},semi:{src:"upgrades/semi.png",img:null},auto:{src:"upgrades/auto.png",img:null},shot:{src:"upgrades/shot.png",img:null},laser:{src:"upgrades/laser.png",img:null},explosion:{src:"upgrades/explosion.png",img:null},sniper:{src:"upgrades/sniper.png",img:null},bold:{src:"upgrades/bold.png",img:null},italic:{src:"upgrades/italic.png",img:null},uppercase:{src:"upgrades/uppercase.png",img:null},underline:{src:"upgrades/underline.png",img:null}}}setup_ui(){this.skip=new TextButton("Skip",{x:0,y:0},{x:textWidth("Skip")+20,y:SQUARE_BUTTON}),this.buttons=[],this.buttons.push(this.skip),this.reset_upgrades(),this.resize()}reset_upgrades(){this.upgrades=[];let t=createVector(250,200);for(let e=3;e>0;e--)this.upgrades.push(new UpgradeCard(createVector(0,0),t,.5*e,this.random_upgrade(),this.images));this.resize()}draw(){super.draw();for(const t of this.upgrades)t.draw()}update(){super.update();for(const t of this.upgrades)t.update()}mouseClicked(){if(this.skip.hover())return 3;for(const t of this.upgrades)if(t.hover())return game.sounds.upgrade.play(),upgrades.push(t.upgrade),3}resize(){const t=this.upgrades.length;for(let e=3;e>0;e--)this.upgrades[t-e].resize(0,WINDOW_TOP+e*height*.25);this.skip.resize(WINDOW_LEFT+.5*(textWidth("Skip")+20)+20,WINDOW_TOP+.5*SQUARE_BUTTON+20)}random_upgrade(){const t=count_traits(team),e=random(Object.keys(t));let s=[...AVAILABLE_UPGRADES];const i=upgrades.filter(t=>t.trait===e);i.length>0&&i.filter(t=>"ammo"in t)&&s.concat([{weapon:3},{weapon:1}]),s.forEach(t=>t.trait=e);const a=[...new Set(team.filter(t=>t.attributes.trait===e).map(t=>t.attributes.weapon))],r=[...new Set(team.filter(t=>t.attributes.trait===e).map(t=>t.attributes.style))];if(s=s.filter(t=>!a.includes(t.weapon)),s=s.filter(t=>!r.includes(t.style)),"special"!==e&&"number"!==e||(s=s.filter(t=>t.style!==STYLE_UPPERCASE)),this.upgrades.length>0)for(const t of this.upgrades.filter(t=>t.upgrade.trait===e))s=s.filter(e=>JSON.stringify(e)!==JSON.stringify(t.upgrade));return random(s)}}class Solid{overlap(t){return this.attributes.pos.dist(t.attributes.pos)<20}walk(){(abs(this.attributes.vel.x)>MIN_VEL||abs(this.attributes.vel.y)>MIN_VEL)&&this.attributes.pos.add(this.attributes.vel)}arena_limit(){this.attributes.pos.x+CHARACTER_SIZE>WINDOW_RIGHT&&this.attributes.vel.x>0&&(this.attributes.vel.x=-this.attributes.vel.x),this.attributes.pos.x-CHARACTER_SIZE<WINDOW_LEFT&&this.attributes.vel.x<0&&(this.attributes.vel.x=-this.attributes.vel.x),this.attributes.pos.y+CHARACTER_SIZE>WINDOW_BOTTOM&&this.attributes.vel.y>0&&(this.attributes.vel.y=-this.attributes.vel.y),this.attributes.pos.y-CHARACTER_SIZE<WINDOW_TOP&&this.attributes.vel.y<0&&(this.attributes.vel.y=-this.attributes.vel.y)}}class SolidBullet extends Solid{constructor(){super(),this.attributes={team:"",damage:0,vel:createVector(0,0),pos:createVector(0,0)}}death(){if(0===bullets.length)return;let t=bullets.indexOf(this);t>-1&&bullets.splice(t,1),this.death_animation()}arena_limit(){this.attributes.pos.x>WINDOW_RIGHT&&this.attributes.vel.x>0&&(this.attributes.vel.x=-this.attributes.vel.x),this.attributes.pos.x<WINDOW_LEFT&&this.attributes.vel.x<0&&(this.attributes.vel.x=-this.attributes.vel.x),this.attributes.pos.y>WINDOW_BOTTOM&&this.attributes.vel.y>0&&(this.attributes.vel.y=-this.attributes.vel.y),this.attributes.pos.y<WINDOW_TOP&&this.attributes.vel.y<0&&(this.attributes.vel.y=-this.attributes.vel.y)}}class Bullet extends SolidBullet{constructor(t,e,s,i,a){super(),this.attributes={team:t,damage:e,vel:s,pos:i},this.target=a.attributes.pos.copy(),this.life=1,game.sounds.bullet.play()}draw(){this.draw_bullet()}update(){this.arena_limit()||this.death();for(const t of entities)if(t.attributes.team!=this.attributes.team&&this.overlap(t))return t.damage(this.attributes.damage),void this.death();this.walk(),this.life>0?this.life-=deltaTime/1e3:this.death(),this.life>.7&&this.attributes.vel.add(p5.Vector.normalize(p5.Vector.sub(this.target,this.attributes.pos)).mult(2))}draw_bullet(){push(),translate(this.attributes.pos.x,this.attributes.pos.y),rotate(this.attributes.vel.heading()),textSize(CHARACTER_SIZE),text("-",0,0),pop()}death_animation(){for(let t=0;t<random(2,4);t++){const t=new BulletParticle(this.attributes.pos.copy(),this.attributes.vel.copy().normalize().rotate(random(-QUARTER_PI,QUARTER_PI)).mult(random(1,5)));particles.push(t)}}arena_limit(){return!(this.attributes.pos.x>WINDOW_RIGHT||this.attributes.pos.x<WINDOW_LEFT||this.attributes.pos.y>WINDOW_BOTTOM||this.attributes.pos.y<WINDOW_TOP)}}class Explosion extends SolidBullet{constructor(t,e,s,i,a){super(),this.attributes={team:t,damage:e,vel:s,pos:i},this.base_size=CHARACTER_SIZE+.2*CHARACTER_SIZE*a,this.size=this.base_size,this.already_hit=[],this.img=game.images.star,this.off=0,this.timer=random(2,3),this.explosion_duration=1,this.rot_vel=random(HALF_PI,2*PI)*random_sign(),this.rot=0,this.play_sound=!0}draw(){this.draw_bullet()}update(){if(this.arena_limit(),this.timer>0)return this.timer-=deltaTime/1e3,this.off=random(0,40),this.timer<.5?(this.size=2*this.base_size*easeInQuad(2*this.timer),this.rot+=this.rot_vel,this.rot_vel*=.8):this.timer<1&&(this.size=this.base_size+this.base_size*easeInQuad(2*(1-this.timer))),this.attributes.vel.mult(.95),void this.walk();this.timer<=0&&this.play_sound&&(game.sounds.explosion.play(),this.play_sound=!1),this.explosion_duration-=deltaTime/1e3,this.size=easeInQuad(2*(1-this.explosion_duration))*this.base_size*2,this.explosion_duration<.5&&(this.size=easeInQuad(1)*this.base_size*2,this.off=random(0,20));for(const t of entities)t.attributes.team!==this.attributes.team&&this.overlap(t)&&(this.already_hit.includes(t)||(this.already_hit.push(t),t.damage(this.attributes.damage)));for(const t of bullets)t.attributes.team===this.attributes.team&&t instanceof Explosion&&this.overlap(t)&&(this.already_hit.push(t),t.attributes.vel.add(t.attributes.pos.copy().sub(this.attributes.pos).normalize().mult(3)));this.explosion_duration<0&&this.death()}draw_bullet(){push(),translate(this.attributes.pos.x,this.attributes.pos.y),noFill(),stroke(SECOND_COLOR);if(this.timer<0)return strokeWeight(easeInQuad(this.explosion_duration)*this.base_size*.25),circle(0,0,this.size+this.off),void pop();this.timer<.5&&(strokeWeight(5*easeInQuad(2*this.timer)),circle(0,0,.25*this.base_size+this.base_size*easeInQuad(2*(.5-this.timer)))),rotate(this.rot),translate(0,0,-5),image(this.img,-.5*(this.size+this.off),-.5*(this.size+this.off),this.size+this.off,this.size+this.off),pop()}death_animation(){}overlap(t){return this.attributes.pos.dist(t.attributes.pos)<this.size}}class Laser extends SolidBullet{constructor(t,e,s,i,a){super(),this.attributes={team:t,damage:e,pos:s},this.current_duration=0,this.duration=3,this.laser_width=0,this.laser_width_1=0,this.laser_width_2=0,this.base_width=10+a*(.1*CHARACTER_SIZE),this.already_hit=[],this.target=extend_target(this.attributes.pos,i.attributes.pos,width+height),this.laser_pos=extend_target(this.attributes.pos,this.target,20+this.base_width),this.play_audio=!0}draw(){this.draw_bullet()}update(){this.current_duration+=deltaTime/1e3;let t=null;if(this.current_duration<.5)return t=easeInQuad(2*(.5-this.current_duration)),this.laser_width=2*t,this.laser_width_1=this.laser_width+random(.2,.3)*this.base_width,void(this.laser_width_2=this.laser_width_1+random(.2,.3)*this.base_width);if(this.current_duration<1)return t=easeInQuad(2*(this.current_duration-.5)),this.laser_width=t*this.base_width,this.laser_width_1=this.laser_width+random(.2,.5)*this.base_width,void(this.laser_width_2=this.laser_width_1+random(.2,.5)*this.base_width);if(this.current_duration<2.5)this.play_audio&&(game.sounds.laser.play(),this.play_audio=!1),this.laser_width=2.5*this.base_width,this.laser_width+=random(.2,.5)*this.base_width,this.laser_width_1=this.laser_width+random(.2,.5)*this.base_width,this.laser_width_2=this.laser_width_1+random(.2,.5)*this.base_width;else{t=easeInExpo(2*(this.duration-this.current_duration));let e=t*this.base_width*2.5;this.laser_width=e,t=easeInQuad(2*(3-this.current_duration)),e=t*this.base_width*2.5,this.laser_width_1=e+t*this.base_width*random(.2,.5),this.laser_width_2=this.laser_width_1+t*this.base_width*random(.2,.5)}for(const t of entities)t.attributes.team!=this.attributes.team&&this.overlap(t.attributes.pos)&&(this.already_hit.includes(t)||(this.already_hit.push(t),t.damage(this.attributes.damage)));this.current_duration>=this.duration&&this.death()}draw_bullet(){push(),strokeCap(ROUND),this.draw_laser(BULLET_COLOR,this.laser_width_2),this.draw_laser(BULLET_COMPLEMENTARY_COLOR,this.laser_width_1),this.draw_laser(SECOND_COLOR,this.laser_width),pop()}draw_laser(t,e){stroke(t),strokeWeight(e),line(this.laser_pos.x,this.laser_pos.y,this.target.x,this.target.y)}overlap(t){const e=this.laser_pos,s=this.target,i=p5.Vector.sub(s,e),a=p5.Vector.sub(e,t);return!(p5.Vector.dot(i,a)>0)&&point_line_dist(t,e,s)<this.laser_width}death_animation(){}}class Particle{constructor(t,e){this.pos=t,this.vel=e,this.acc=createVector(0,1),this.floor=t.y+random(20,50),this.alpha=255,this.animation=.2,this.turn=!1,this.size=1}update(){this.vel.mult(.95),this.pos.add(this.vel),this.alpha-=5}draw(){this.draw_particle()}finished(){return this.alpha<=0||this.size<=0}}class BulletParticle extends Particle{draw_particle(){push(),noStroke(),fill(255,this.alpha),rect(this.pos.x,this.pos.y,CHARACTER_SIZE/8,CHARACTER_SIZE/8),pop()}}class DeathParticle extends Particle{update(){this.vel.y*=.9,this.vel.add(this.acc),this.pos.y>=this.floor&&(this.vel.y=-this.vel.y),this.pos.add(this.vel),this.alpha-=5,this.animation-=deltaTime/1e3}draw_particle(){push(),noStroke(),this.animation<0&&(this.animation=.2,this.turn=!this.turn),fill(255,this.alpha),this.turn?rect(this.pos.x-0,this.pos.y-CHARACTER_SIZE/8,CHARACTER_SIZE/8*1,CHARACTER_SIZE/8*2):rect(this.pos.x-CHARACTER_SIZE/8,this.pos.y-0,CHARACTER_SIZE/8*2,CHARACTER_SIZE/8*1),pop()}}class TrailParticle extends Particle{setup(){this.size=10}update(){this.vel.mult(.95),this.pos.add(this.vel),this.alpha-=5,this.size-=.2}draw_particle(){push(),noStroke(),fill(255,this.alpha),circle(this.pos.x,this.pos.y,this.size),pop()}finished(){return this.alpha<=0||this.size<=0}}class StarParticle extends Particle{constructor(t,e){super(),this.img=game.images.star}setup(){this.size=20,this.rot=random_sign()*random(PI,2*PI)}update(){this.vel.mult(.95),this.pos.add(this.vel),this.alpha-=5,this.size-=.2}draw_particle(){push(),tint(255,this.alpha),translate(this.pos.x,this.pos.y),rotate(this.rot),imageMode(CENTER),image(this.img,0,0,20+this.size,20+this.size),pop(),this.size*=.9,this.rot*=.9}}class Entity extends Solid{constructor(){super(),this.attributes={team:-1,trait:"",style:STYLE_NORMAL,weapon:2,current_ammo:1,ammo:1,damage:5,current_health:10,max_health:10,upgrades:{ammo:0,damage:0,current_health:0,max_health:0},action:{},vel:createVector(0,0),pos:createVector(0,0)},this.animation={show_bar:3,fire_delay:-1,particle_animation:.05,ghost_animation:.05},this.ghost=[],this.block=!1,this.restore()}mouseClicked(){}update(){this.update_animations(),(abs(this.attributes.vel.x)>0||abs(this.attributes.vel.y)>0)&&(this.arena_limit(),this.attributes.vel.mult(.8),this.walk()),this.update_action()}draw(){if(this.draw_char(),this.current_animation.show_bar>=this.animation.show_bar)return;const t=lerp(255,0,this.current_animation.show_bar/this.animation.show_bar);this.draw_health_bar(t),this.draw_action_bar(t)}draw_char(){push(),textSize(CHARACTER_SIZE);let t=this.char;switch(this.attributes.style){case STYLE_BOLD:textSize(1.25*CHARACTER_SIZE);break;case STYLE_ITALIC:if(textStyle(ITALIC),0!==this.attributes.action.name)break;for(const t in this.ghost)SECOND_COLOR.setAlpha(t/5*255),text(this.char,this.ghost[t].x,this.ghost[t].y);break;case STYLE_UPPERCASE:t=t.toUpperCase();break;case STYLE_UNDERLINE:if(!this.block)break;noStroke(),rect(this.attributes.pos.x-.4*CHARACTER_SIZE,this.attributes.pos.y+.5*CHARACTER_SIZE+.1*CHARACTER_SIZE,.7*CHARACTER_SIZE,.1*CHARACTER_SIZE)}SECOND_COLOR.setAlpha(255),text(t,this.attributes.pos.x,this.attributes.pos.y),pop()}draw_health_bar(t){push(),noStroke(),fill(color(255,0,0,t)),rect(this.attributes.pos.x-.5*CHARACTER_SIZE,this.attributes.pos.y-(.5*CHARACTER_SIZE+.2*CHARACTER_SIZE),CHARACTER_SIZE*(this.attributes.current_health/this.all_max_health),.1*CHARACTER_SIZE),pop()}draw_action_bar(t){push(),noStroke(),fill(color(0,255,0,t));let e=(this.attributes.action.cooldown-this.attributes.action.bar)/this.attributes.action.cooldown;e<0&&(e=.1),rect(this.attributes.pos.x-CHARACTER_SIZE/2,this.attributes.pos.y-CHARACTER_SIZE/2,CHARACTER_SIZE*e,CHARACTER_SIZE/10),pop()}update_animations(){for(const t in this.animation)this.current_animation[t]+=deltaTime/1e3}shoot(t){let e,s=p5.Vector.normalize(p5.Vector.sub(t.attributes.pos,this.attributes.pos));switch(this.attributes.weapon){case 5:e=new Laser(this.attributes.team,this.all_damage,createVector(this.attributes.pos.x,this.attributes.pos.y),t,this.all_ammo),s=s.mult(.5*e.base_width);break;case 6:s=s.mult(random(15,20)).rotate(random(-QUARTER_PI,QUARTER_PI)),e=new Explosion(this.attributes.team,this.all_damage,s,createVector(this.attributes.pos.x,this.attributes.pos.y),this.all_ammo);break;case 7:s=s.mult(this.all_damage),e=new Bullet(this.attributes.team,this.all_damage*this.all_ammo,s,createVector(this.attributes.pos.x,this.attributes.pos.y),t);break;default:s=s.rotate(random(-QUARTER_PI,QUARTER_PI)).mult(this.all_damage),e=new Bullet(this.attributes.team,this.all_damage,s,createVector(this.attributes.pos.x,this.attributes.pos.y),t)}return bullets.push(e),s}alive(){return this.attributes.current_health>0}death(){if(0===entities.length)return;let t=entities.indexOf(this);t>-1&&entities.splice(t,1),this.death_animation(),game.sounds.death.play()}damage(t){this.block?this.block=!1:(game.sounds.hit.play(),this.current_animation.show_bar=0,this.attributes.current_health=max(this.attributes.current_health-t,0),this.attributes.current_health<=0&&this.death())}next_action(){const t=random([0,1]);return 0===t&&this.attributes.style===STYLE_ITALIC&&game.sounds.dash.play(),t}next_target(){let t=null;for(const e of entities)e.attributes.team!=this.attributes.team&&(null==t||this.attributes.pos.dist(e.attributes.pos)<this.attributes.pos.dist(t.attributes.pos))&&(t=e);return t}restore(){this.ghost=[],this.attributes.style===STYLE_UNDERLINE&&(this.block=!0);const t=[-1,.5*this.attributes.action.cooldown/this.all_ammo,this.attributes.action.cooldown/this.all_ammo,-1,random(.1,.3),-1,.5*this.attributes.action.cooldown/this.all_ammo,-1];this.animation.fire_delay=t[this.attributes.weapon],this.attributes.current_health=this.all_max_health,this.attributes.vel=createVector(0,0),this.attributes.action={name:0,cooldown:1,bar:1},this.current_animation={show_bar:3,fire_delay:0,particle_animation:0,ghost_animation:0}}hover(){return MOUSE_X>this.attributes.pos.x-.5*CHARACTER_SIZE&&MOUSE_X<this.attributes.pos.x+.5*CHARACTER_SIZE&&MOUSE_Y>this.attributes.pos.y-.5*CHARACTER_SIZE&&MOUSE_Y<this.attributes.pos.y+.5*CHARACTER_SIZE}get all_ammo(){return this.attributes.ammo+this.attributes.upgrades.ammo}get all_damage(){return this.attributes.style===STYLE_BOLD?1.5*(this.attributes.damage+this.attributes.upgrades.damage):this.attributes.damage+this.attributes.upgrades.damage}get all_max_health(){return this.attributes.style===STYLE_UPPERCASE?2*(this.attributes.max_health+this.attributes.upgrades.max_health):this.attributes.max_health+this.attributes.upgrades.max_health}}class Char extends Entity{constructor(t,e){super(),this.attributes.team=t,this.attributes.trait=get_trait(e),this.char=e}setup(){for(const t in this.attributes.upgrades)this.attributes.upgrades[t]=0;this.attributes.team===PLAYER_TEAM&&(this.attributes.style=STYLE_ITALIC,this.attributes.ammo=10),this.attributes.team,ENEMY_TEAM}update_action(){if(1===this.attributes.action.name){if(4===this.attributes.weapon)return void this.attack();-1!=this.animation.fire_delay&&this.current_animation.fire_delay>=this.animation.fire_delay&&this.attributes.current_ammo>0&&(this.current_animation.fire_delay=0,this.attack())}if(0===this.attributes.action.name&&this.current_animation.ghost_animation>this.animation.ghost_animation&&(this.ghost.push(this.attributes.pos.copy()),this.ghost.length>5&&this.ghost.splice(0,1)),this.attributes.action.bar-=deltaTime/1e3,!(this.attributes.action.bar>0))switch(this.attributes.action.name=this.next_action(),this.attributes.action.bar=this.attributes.action.cooldown,this.current_animation.fire_delay=0,this.attributes.current_ammo=this.all_ammo,this.attributes.action.name){case 0:let t=3,e=5;this.attributes.style===STYLE_ITALIC&&(t=20,e=20),this.attributes.vel=createVector(random(t,e)*random_sign(),random(t,e)*random_sign());break;case 1:this.attack()}}death_animation(){for(let t=0;t<random(6,12);t++){const t=new DeathParticle(this.attributes.pos.copy().add(createVector(random(-CHARACTER_SIZE/4,CHARACTER_SIZE/4),random(-CHARACTER_SIZE/2,CHARACTER_SIZE/2))),p5.Vector.normalize(createVector(random(10,20)*(random_bool()?-1:1),random(-CHARACTER_SIZE,1.3*-CHARACTER_SIZE))));particles.push(t)}}attack(){const t=this.next_target();if(null===t)return;const e=createVector(0,0);switch(this.attributes.weapon){case 4:return void this.attack_kamikaze(t);case 3:for(;this.attributes.current_ammo>0;)e.add(this.shoot(t)),this.attributes.current_ammo--;break;case 1:e.add(this.shoot(t)).mult(.1),this.attributes.current_ammo--;break;case 5:e.add(this.shoot(t)).mult(.5),this.attributes.current_ammo=0,this.attributes.action.bar=4;break;case 6:e.add(this.shoot(t)).mult(0),this.attributes.current_ammo--;break;default:e.add(this.shoot(t)).mult(.3),this.attributes.current_ammo--}this.attributes.vel=e.mult(-1)}attack_kamikaze(t){const e=t.attributes.pos.copy().sub(this.attributes.pos).normalize().mult((1+this.current_animation.fire_delay)**3);if(this.current_animation.fire_delay<this.animation.fire_delay?this.attributes.vel.sub(e):this.attributes.vel.add(e),this.current_animation.particle_animation>this.animation.particle_animation){for(let t=0;t<round(random(1,3));t++){const t=new TrailParticle(this.attributes.pos.copy(),this.attributes.vel.copy().normalize().rotate(random(-QUARTER_PI,QUARTER_PI)).mult(random(-5,-1)));t.setup(),particles.push(t)}this.current_animation.particle_animation=0}this.overlap(t)&&(this.current_animation.fire_delay=0,t.damage(this.all_max_health),this.damage(this.all_max_health))}}class ViewChar extends Char{draw(){this.draw_char()}draw_char(){push(),textAlign(LEFT),textSize(2*CHARACTER_SIZE),text(this.char,this.attributes.pos.x,this.attributes.pos.y),pop()}next_action(){return 0}}class Doll extends Char{constructor(t,e){super(t,e)}next_action(){return 0}}class Boss extends Char{constructor(t,e){super(t,e)}setup(){this.animation.spin_animation=0,this.spin_animation_vel=1,this.dolls_per_circle=10,this.circles=4,this.dolls=[];for(let t=0;t<this.circles;t++){const t=[];for(let e=0;e<this.dolls_per_circle;e++){const e=new Doll(this.attributes.team,random(AVAILABLE_CHARACTERS));e.attributes.pos=createVector(random(.75*width,width)*random_sign(),random(.75*height,height)*random_sign()),e.attributes.weapon=4,t.push(e),entities.push(e)}this.dolls.push(t)}this.attributes.team,ENEMY_TEAM}update(){super.update(),this.animation.spin_animation+=this.spin_animation_vel*deltaTime/1e3,this.animation.spin_animation>=1&&(this.spin_animation_vel*=-1),this.animation.spin_animation<=-1&&(this.spin_animation_vel*=-1),this.update_dolls()}update_dolls(){for(const t in this.dolls)for(let e=0;e<this.dolls[t].length;e++){let s=createVector(this.attributes.pos.x,this.attributes.pos.y);s.add(this.circle_function(t,e)),this.dolls[t][e].attributes.pos.add(s.sub(this.dolls[t][e].attributes.pos).normalize().mult(10))}}attack(){if(null==this.next_target())return;if(0===this.dolls.length)return;const t=random(this.dolls),e=random(t);let s=t.indexOf(e);s>-1&&t.splice(s,1),e.attributes.action.name=1,0===t.length&&(s=this.dolls.indexOf(t),s>-1&&this.dolls.splice(s,1))}circle_function(t,e){const s=[{x:20*sin(this.attributes.action.bar*PI*2+2*PI/this.dolls_per_circle*e),y:100*cos(this.attributes.action.bar*PI*2+2*PI/this.dolls_per_circle*e)},{x:100*sin(this.attributes.action.bar*PI*2+2*PI/this.dolls_per_circle*e),y:20*cos(this.attributes.action.bar*PI*2+2*PI/this.dolls_per_circle*e)},{x:75*sin(this.attributes.action.bar*PI*2+2*PI/this.dolls_per_circle*e),y:75*sin(this.attributes.action.bar*PI*2+2*PI/this.dolls_per_circle*(e+1))},{x:75*-sin(this.attributes.action.bar*PI*2+2*PI/this.dolls_per_circle*(e+1)),y:75*sin(this.attributes.action.bar*PI*2+2*PI/this.dolls_per_circle*e)}];return createVector(s[t].x,s[t].y)}}class Prop{constructor(){this.pos=createVector(0,0),this.vel=createVector(0,0),this.size={x:0,y:0}}hover(){return MOUSE_X>this.pos.x-.5*this.size.x&&MOUSE_X<this.pos.x+.5*this.size.x&&MOUSE_Y>this.pos.y-.5*this.size.y&&MOUSE_Y<this.pos.y+.5*this.size.y}mouseClicked(){}mouseMoved(){}touchStarted(){}touchMoved(){}touchEnded(){}resize(){}}class GeneralButton extends Prop{constructor(t,e,s){super(),this.pos=t,this.size=e,this.active=s,this.gap_max=SHADOW_GAP,this.gap=0,this.on_top=!1,this.layer=createFramebuffer(),this.layer.resize(ceil(this.size.x+2*(STROKE_WEIGHT+SHADOW_GAP)),ceil(this.size.y+2*(STROKE_WEIGHT+SHADOW_GAP))),this.layer_img=null}draw(){this.gap===SHADOW_GAP?image(this.layer_img,this.pos.x-.5*this.layer_img.width,this.pos.y-.5*this.layer_img.height):this.draw_button()}resize(t,e){this.pos.x=t,this.pos.y=e}update(){this.on_top?this.gap>0&&(this.gap-=1):this.active&&this.gap<this.gap_max&&(this.gap+=1),null===this.layer_img&&this.gap===SHADOW_GAP&&this.freeze()}freeze(){this.layer.begin(),clear();const t=this.pos.x,e=this.pos.y;this.pos.x=0,this.pos.y=0,this.draw_button(),this.pos.x=t,this.pos.y=e,this.layer.end(),this.layer_img=this.layer.get()}mouseMoved(){this.update_button()}touchStarted(){this.update_button()}touchMoved(){this.update_button()}touchEnded(){this.update_button(!0)}update_button(t=!1){this.active&&(this.hover()?(this.on_top=!0,t&&(this.on_top=!1)):this.on_top=!1)}draw_button(){push(),noFill(),this.gap>0&&(translate(0,0,-5),stroke(MAIN_COLOR_SHADOW),rect(this.pos.x-this.size.x/2+this.gap,this.pos.y-this.size.y/2+this.gap,this.size.x,this.size.y),translate(0,0,5)),this.active?(stroke(SECOND_COLOR),rect(this.pos.x-this.size.x/2-this.gap,this.pos.y-this.size.y/2-this.gap,this.size.x,this.size.y)):0===this.gap&&(stroke(MAIN_COLOR_SHADOW),rect(this.pos.x-this.size.x/2,this.pos.y-this.size.y/2,this.size.x,this.size.y)),pop()}draw_content(){}}class TextButton extends GeneralButton{constructor(t,e,s,i=!0){super(e,s,i),this.text=t}draw_button(){push(),noStroke(),fill(MAIN_COLOR),translate(0,0,-5),rect(this.pos.x-this.size.x/2-this.gap,this.pos.y-this.size.y/2-this.gap,this.size.x,this.size.y),pop(),this.draw_content(),super.draw_button()}draw_content(){textAlign(CENTER),this.active?text(this.text,this.pos.x-this.gap,this.pos.y-this.gap-.1*CHARACTER_SIZE):(push(),stroke(MAIN_COLOR),fill(MAIN_COLOR_SHADOW),text(this.text,this.pos.x,this.pos.y-.1*CHARACTER_SIZE),pop())}}class ImageButton extends GeneralButton{constructor(t,e,s,i=!0){super(e,s,i),this.image=t,this.image_x=this.size.x-STROKE_WEIGHT,this.image_y=this.size.y-STROKE_WEIGHT}draw_button(){push(),noStroke(),fill(MAIN_COLOR),translate(0,0,-5),rect(this.pos.x-this.size.x/2-this.gap,this.pos.y-this.size.y/2-this.gap,this.size.x,this.size.y),pop(),super.draw_button(),this.draw_content()}draw_content(){this.active?image(this.image,this.pos.x-.5*(this.size.x-4)-this.gap,this.pos.y-.5*(this.size.y-4)-this.gap,this.size.x-4,this.size.y-4):(push(),tint(255,127),image(this.image,this.pos.x-.5*this.size.x,this.pos.y-.5*this.size.y,this.size.x,this.size.y),pop())}}class Carrousel extends Prop{constructor(t,e,s){super(),this.pos=t,this.set=e,this.size=s,this.index=0,this.scroll=0,this.config={quantity:4,info:!1,effects:!1},this.set.length>0&&this.set[0]instanceof Char&&(this.config.info=!0),MOBILE&&(this.move_char=!1)}draw(){this.config.info&&this.draw_info()}update(){if(!MOBILE){if(this.hover()&&MOUSE_X>WINDOW_RIGHT-.2*width&&this.index<this.set.length-1)return this.scroll+=deltaTime/1e3,void(this.index+=.05+.3*this.scroll);if(this.hover()&&MOUSE_X<WINDOW_LEFT+.2*width&&this.index>0)return this.scroll+=deltaTime/1e3,void(this.index-=.05+.3*this.scroll)}this.scroll=0;const t=this.index%1;t>.5?this.index+=.03*t:this.index-=.03*t}touchStarted(){this.hover()&&(this.move_char=!0)}touchMoved(){this.move_char&&this.hover()&&(this.index+=(pmouseX+WINDOW_LEFT-MOUSE_X)/100,this.index>this.set.length-1&&(this.index=this.set.length-1.001),this.index<0&&(this.index=0))}touchEnded(){this.move_char&&(this.move_char=!1)}resize(t,e){this.pos.x=t,this.pos.y=e}draw_char(){}draw_info(){let t=ceil(this.index);0===t&&(t=1),t===this.set.length&&(t=this.set.length),push(),textSize(2*CHARACTER_SIZE),fill(MAIN_COLOR_SHADOW),text(`${t}/${this.set.length}`,this.pos.x+SHADOW_GAP,this.pos.y-.53*this.size+SHADOW_GAP),fill(SECOND_COLOR),text(`${t}/${this.set.length}`,this.pos.x-SHADOW_GAP,this.pos.y-.53*this.size-SHADOW_GAP),pop()}current_char(){return this.set[round(this.index)]}hover(){return MOUSE_Y<this.pos.y+.75*this.size*.5&&MOUSE_Y>this.pos.y-.75*this.size*.5}}class EditorCarrousel extends Carrousel{constructor(t,e,s){super(t,e,s),MOBILE&&(this.select_char=!1,this.select_char_pos={x:0,y:0},this.select_char_rot=0)}draw(){super.draw();for(let t=floor(this.index)-this.config.quantity;t<this.index+this.config.quantity+1;t++)if(!(t<0||t>=this.set.length)){if(MOBILE&&this.select_char&&t===floor(this.index)){const e=this.pos.x,s=this.pos.y;this.pos.x=MOUSE_X+this.select_char_pos.x,this.pos.y=MOUSE_Y+this.select_char_pos.y,this.draw_char(this.index-t,t,s),this.pos.x=e,this.pos.y=s;continue}this.draw_char(this.index-t,t)}}touchStarted(){if(this.hover())return MOUSE_X<.75*this.size*.5+.5*CHARACTER_SIZE&&MOUSE_X>.75*-this.size*.5-.5*CHARACTER_SIZE?(this.select_char=!0,void(this.select_char_pos={x:this.pos.x-MOUSE_X,y:this.pos.y-MOUSE_Y})):void super.touchStarted()}touchMoved(){this.select_char?this.select_char_rot=(mouseX-pmouseX)/100:super.touchMoved()}touchEnded(){return super.touchEnded(),!!this.select_char&&(this.select_char=!1,!0)}draw_char(t,e,s=0){let i=this.set[e];if(push(),textSize(this.size/(1+abs(t))),MOBILE&&this.select_char&&e===floor(this.index)){const t=(s-.5*height)/(MOUSE_Y-.5*height);textSize(max(this.size/t,this.size))}MAIN_COLOR_SHADOW.setAlpha(255-abs(255*t/this.config.quantity)),fill(MAIN_COLOR_SHADOW),translate(this.pos.x,this.pos.y),MOBILE&&this.select_char&&e===floor(this.index)&&rotate(this.select_char_rot),text(i instanceof Char?i.char:i,-150*t+SHADOW_GAP+.05*this.size,SHADOW_GAP),MAIN_COLOR_SHADOW.setAlpha(255),SECOND_COLOR.setAlpha(255-abs(255*t/this.config.quantity)),fill(SECOND_COLOR),text(i instanceof Char?i.char:i,-150*t-SHADOW_GAP+.05*this.size,-SHADOW_GAP),SECOND_COLOR.setAlpha(255),pop()}}class ViewCarrousel extends Carrousel{draw(){super.draw();for(let t=floor(this.index)-this.config.quantity;t<this.index+this.config.quantity+1;t++)t<0||t>=this.set.length||this.draw_char(this.index-t,t)}draw_char(t,e){let s=this.set[e];push(),textSize(this.size/(1+abs(t))),MAIN_COLOR_SHADOW.setAlpha(255-abs(255*t/this.config.quantity)),fill(MAIN_COLOR_SHADOW),text(s instanceof Char?s.char:s,this.pos.x-150*t+SHADOW_GAP+.05*this.size,this.pos.y+SHADOW_GAP),MAIN_COLOR_SHADOW.setAlpha(255),SECOND_COLOR.setAlpha(255-abs(255*t/this.config.quantity)),fill(SECOND_COLOR),s instanceof Char&&0==s.attributes.current_health&&(DEAD_COLOR.setAlpha(255-abs(255*t/this.config.quantity)),fill(DEAD_COLOR),DEAD_COLOR.setAlpha(255)),text(s instanceof Char?s.char:s,this.pos.x-150*t-SHADOW_GAP+.05*this.size,this.pos.y-SHADOW_GAP),SECOND_COLOR.setAlpha(255),pop()}}class Popup extends Prop{constructor(t,e){super(),this.gap=10,this.initial_pos,this.final_pos,this.resize(),this.pos=this.initial_pos.copy(),this.size=createVector(BUTTON_WIDTH,BUTTON_HEIGHT),this.text=t,this.icon=e,this.animation={intro:1,delay:1,outro:1},this.current_animation={intro:0,delay:0,outro:0},this.layer=createFramebuffer(),this.layer.resize(this.size.x+STROKE_WEIGHT,this.size.y+STROKE_WEIGHT),this.layer_img=null}draw(){this.layer_img.width,this.pos.x,width,this.layer_img.width,this.layer_img.height,this.pos.y,height,this.layer_img.height;image(this.layer_img,this.pos.x-.5*this.layer_img.width,this.pos.y-.5*this.layer_img.height)}resize(){this.initial_pos=createVector(WINDOW_RIGHT-.5*BUTTON_WIDTH-this.gap,WINDOW_TOP-.5*BUTTON_HEIGHT-this.gap),this.final_pos=createVector(WINDOW_RIGHT-.5*BUTTON_WIDTH-this.gap,WINDOW_TOP+.5*BUTTON_HEIGHT+this.gap)}update(){null===this.layer_img&&this.freeze(),this.current_animation.intro<this.animation.intro?(this.current_animation.intro+=deltaTime/1e3,this.pos=p5.Vector.lerp(this.initial_pos,this.final_pos,easeOutElastic(this.current_animation.intro))):this.current_animation.delay<this.animation.delay?(this.current_animation.delay+=deltaTime/1e3,this.pos=this.final_pos):this.current_animation.outro<this.animation.outro&&(this.current_animation.outro+=deltaTime/1e3,this.pos=p5.Vector.lerp(this.final_pos,this.initial_pos,easeOutElastic(this.current_animation.outro)))}freeze(){this.layer.begin(),clear();const t=this.pos.x,e=this.pos.y;this.pos.x=0,this.pos.y=0,this.draw_popup(),this.pos.x=t,this.pos.y=e,this.layer.end(),this.layer_img=this.layer.get()}draw_popup(){push(),fill(MAIN_COLOR_SHADOW),rect(this.pos.x-.5*this.size.x,this.pos.y-.5*this.size.y,this.size.x,this.size.y);const t=BUTTON_HEIGHT-20;noStroke(),fill(MAIN_COLOR),rect(this.pos.x+this.gap-.5*this.size.x,this.pos.y-.5*t,t,t),image(this.icon,this.pos.x+this.gap-.5*this.size.x,this.pos.y-.5*t,t,t),fill(SECOND_COLOR),textAlign(LEFT),textSize(.8*CHARACTER_SIZE),textWrap(WORD),text(this.text,this.pos.x-.5*this.size.x+t+2*this.gap,this.pos.y-5,this.size.x-t-2*this.gap),pop()}finished(){return this.current_animation.outro>=this.animation.outro}}class Slider extends Prop{constructor(t,e,s,i){super(),this.text=t,this.pos=e,this.size={x:s,y:10},this.gap=SHADOW_GAP,this.gap_max=SHADOW_GAP,this.bar=s*i,this.hover_bar=0}get value(){return this.bar/this.size.x}draw(){push(),strokeWeight(STROKE_WEIGHT),noFill(),translate(0,0,-5),stroke(MAIN_COLOR_SHADOW),rect(this.pos.x-.5*this.size.x+this.gap,this.pos.y+this.gap,this.size.x,this.size.y),noStroke(),fill(MAIN_COLOR_SHADOW),rect(this.pos.x-.5*this.size.x+this.gap,this.pos.y+this.gap,this.bar,this.size.y),translate(0,0,5),this.hover()&&(noStroke(),fill(lerpColor(SECOND_COLOR,MAIN_COLOR,.5)),rect(this.pos.x-.5*this.size.x-this.gap,this.pos.y-this.gap,this.hover_bar,this.size.y)),noStroke(),fill(SECOND_COLOR),rect(this.pos.x-.5*this.size.x-this.gap,this.pos.y-this.gap,this.bar,this.size.y),text(this.text,this.pos.x+.5*textWidth(this.text)-.5*this.size.x-this.gap,this.pos.y-this.gap-3-4*this.size.y),noFill(),stroke(SECOND_COLOR),rect(this.pos.x-.5*this.size.x-this.gap,this.pos.y-this.gap,this.size.x,this.size.y),pop()}update(){if(this.hover())return this.gap>0&&(this.gap-=1),void(this.hover_bar=MOUSE_X<0?MOUSE_X-this.pos.x+.5*this.size.x:this.size.x+MOUSE_X-this.pos.x-.5*this.size.x);this.gap<this.gap_max&&(this.gap+=1)}mouseClicked(){this.hover()&&(this.bar=this.hover_bar)}resize(t,e){this.pos.x=t,this.pos.y=e}}class UpgradeCard extends Prop{constructor(t,e,s,i,a){super(),this.delay=s,this.size=e,this.pos=createVector(0,WINDOW_TOP-e.y/2),this.start_pos=createVector(0,WINDOW_TOP-e.y/2),this.final_pos=t,this.animation=2,this.current_animation=0,this.rot=0,this.final_rot=PI,this.upgrade=i,this.name=i.trait,this.img=this.get_image(a),this.play_audio=!0}draw(){push(),noFill(),push(),translate(this.pos.x,this.pos.y-.5*this.size.y,145),rotateY(this.rot),stroke(MAIN_COLOR_SHADOW),this.rot<HALF_PI?rect(SHADOW_GAP-.5*this.size.x,SHADOW_GAP,this.size.x,this.size.y):rect(-3*SHADOW_GAP-.5*this.size.x,SHADOW_GAP,this.size.x,this.size.y),pop(),push(),translate(this.pos.x,this.pos.y-.5*this.size.y,150),rotateY(this.rot),fill(MAIN_COLOR),stroke(SECOND_COLOR),rect(-SHADOW_GAP-.5*this.size.x,-SHADOW_GAP,this.size.x,this.size.y),noStroke(),this.rot<HALF_PI?(translate(0,.5*this.size.y,1),this.draw_front()):(rotateY(PI),translate(0,.5*this.size.y,1),this.draw_back()),pop(),pop()}draw_front(){image(this.img,.5*-this.img.width,-.5*this.img.height-.5*CHARACTER_SIZE,this.img.width,this.img.height),fill(SECOND_COLOR),textSize(CHARACTER_SIZE),text(this.name,0,.5*this.img.height)}draw_back(){textSize(.6*CHARACTER_SIZE),"weapon"in this.upgrade?this.draw_weapon_description():"style"in this.upgrade?this.draw_style_description():this.draw_buff_description()}draw_weapon_description(){let t="Equip ",e=`${this.upgrade.trait}`,s=-20;fill(SECOND_COLOR),text(t,-.5*textWidth(e),20),fill(TEAM_COLOR),text(e,.5*textWidth(t),20),t="with ",e=`${WEAPON_NAME[this.upgrade.weapon]}`,fill(SECOND_COLOR),text(t,.5*-textWidth(e),.7*CHARACTER_SIZE-s),fill(UPGRADE_COLOR),text(e,.5*textWidth(t),.7*CHARACTER_SIZE-s)}draw_style_description(){let t="Transform ",e=`${this.upgrade.trait}`;const s=-.7*CHARACTER_SIZE;switch(fill(SECOND_COLOR),text(t,-.5*textWidth(e),s),fill(TEAM_COLOR),text(e,.5*textWidth(t),s),t="into ",e=`${STYLE_NAME[this.upgrade.style]}`,fill(SECOND_COLOR),text(t,.5*-textWidth(e),.7*CHARACTER_SIZE+s),fill(UPGRADE_COLOR),text(e,.5*textWidth(t),.7*CHARACTER_SIZE+s),this.upgrade.style){case STYLE_ITALIC:t="(Walk longer)";break;case STYLE_BOLD:t="(1.5x Damage)";break;case STYLE_UPPERCASE:t="(2.0x Health)";break;case STYLE_UNDERLINE:t="(Block first attack)"}fill(DEAD_COLOR),text(t,0,1.4*CHARACTER_SIZE+s)}draw_buff_description(){let t=0;for(const e in this.upgrade.buffs){let s=`${e}: `,i=`${this.upgrade.buffs[e]}`;fill(SECOND_COLOR),text(s,-.5*textWidth(i),CHARACTER_SIZE*t*.6-20),fill(UPGRADE_COLOR),text(i,.5*textWidth(s),CHARACTER_SIZE*t*.6-20),t++}}update(){this.hover()&&this.rot<this.final_rot&&(this.rot+=.05*PI),!this.hover()&&this.rot>0&&(this.rot-=.05*PI);const t=deltaTime/1e3;this.delay>0?this.delay-=t:(this.play_audio&&(game.sounds.upgrade.play(),this.play_audio=!1),this.current_animation<this.animation&&(this.current_animation+=t,this.pos=p5.Vector.lerp(this.start_pos,this.final_pos,easeOutElastic(this.current_animation/this.animation))))}get_image(t){if("buffs"in this.upgrade){if("ammo"in this.upgrade.buffs)return t.ammo_up.img;if("damage"in this.upgrade.buffs)return t.damage_up.img;if("max_health"in this.upgrade.buffs)return t.health_up.img}if("weapon"in this.upgrade)switch(this.upgrade.weapon){case 3:return t.shot.img;case 2:return t.semi.img;case 1:return t.auto.img;case 5:return t.laser.img;case 6:return t.explosion.img;case 7:return t.sniper.img}if("style"in this.upgrade)switch(this.upgrade.style){case STYLE_ITALIC:return t.italic.img;case STYLE_BOLD:return t.bold.img;case STYLE_UPPERCASE:return t.uppercase.img;case STYLE_UNDERLINE:return t.underline.img}return t.ammo_up.img}hover(){return MOUSE_X>this.pos.x-.6*this.size.x&&MOUSE_X<this.pos.x+.6*this.size.x&&MOUSE_Y>1.2*this.pos.y-.6*this.size.y&&MOUSE_Y<1.2*this.pos.y+.6*this.size.y}mouseClicked(){}resize(t,e){this.final_pos.x=t,this.final_pos.y=e}}class Game{constructor(){this.font_size=32,this.save_name="save",this.state=0,this.screen=[],this.screen.push(new Menu),this.screen.push(new TeamEditor),this.screen.push(new TeamViewEditor),this.screen.push(new Battle),this.screen.push(new BattleMenu),this.screen.push(new TeamView),this.screen.push(new Upgrade),this.screen.push(new Settings),this.screen.push(new SandBox),this.screen.push(new Achievement),this.screen.push(new Traits),this.background_color=1,this.popup=[],setup_achievements(),this.sounds={},this.images={}}load(t,e,s){this.font=loadFont(`${s}/ark-pixel-10px-monospaced-latin.ttf`),this.screen[0].load(e),this.screen[1].load(e),this.screen[2].load(e),this.screen[3].load(e),this.screen[4].load(e),this.screen[5].load(e),this.screen[6].load(e),this.screen[7].load(e),this.screen[8].load(e),this.screen[9].load(e,[this.screen[6].images.italic.img,this.screen[6].images.bold.img,this.screen[6].images.uppercase.img,this.screen[6].images.underline.img,this.screen[6].images.sniper.img,this.screen[6].images.sniper.img,this.screen[6].images.explosion.img,this.screen[6].images.laser.img]),this.screen[10].load(t,e);const i={star:"particles/star.png"};for(const t in i)this.images[t]=loadImage(`${e}/${i[t]}`);const a={explosion:"explosion.wav",laser:"laser.wav",bullet:"bullet.wav",dash:"dash.wav",death:"death.wav",hit:"hit.wav",upgrade:"upgrade.wav"};for(const e in a)this.sounds[e]=loadSound(`${t}/${a[e]}`),this.sounds[e].playMode("sustain")}setup(){textAlign(CENTER,CENTER),textFont(this.font),textSize(this.font_size),textWrap(WORD),strokeWeight(STROKE_WEIGHT),strokeJoin(MITER),stroke(SECOND_COLOR),fill(SECOND_COLOR),this.screen[this.state].setup(),this.restore_save(),this.set_volumes(),setup_achievements()}set_volumes(){for(const t in this.sounds)this.sounds[t].setVolume(VOLUME)}draw(){switch(background(MAIN_COLOR),this.state){case 0:this.screen[0].update(),this.screen[0].draw();break;case 3:this.screen[3].pause,this.screen[3].update(),this.screen[3].draw();break;case 4:this.screen[3].pause||this.screen[3].update(),this.screen[3].draw(),this.screen[4].update(),this.screen[4].draw();break;case 5:this.screen[3].pause||this.screen[3].update(),this.screen[3].draw(),this.screen[5].update(),this.screen[5].draw();break;case 6:this.screen[3].pause,this.screen[3].update(),this.screen[3].draw(),this.screen[6].update(),this.screen[6].draw();break;default:this.screen[this.state].update(),this.screen[this.state].draw()}this.popup.length>0&&(this.popup[0].update(),this.popup[0].draw(),this.popup[0].finished()&&this.popup.splice(0,1))}resize(){this.screen[this.state].resize(),this.popup.length>0&&this.popup[0].resize()}mouseMoved(){this.screen[this.state].mouseMoved()}mouseClicked(){userStartAudio();let t=this.screen[this.state].mouseClicked();this.save(),void 0!==t&&this.next_state(t)}touchStarted(){this.screen[this.state].touchStarted()}touchMoved(){this.screen[this.state].touchMoved()}touchEnded(){userStartAudio();const t=this.screen[this.state].touchEnded();this.save(),void 0!==t&&this.next_state(t)}save(){const t=JSON.stringify({current_colors:CURRENT_COLORS,achievements_status:ACHIEVEMENTS_STATUS,achievements_unlocked:ACHIEVEMENTS_UNLOCKED,volume:VOLUME,team:get_team_word()});localStorage.setItem("save",t)}has_save(){return null!==localStorage.getItem("save")}restore_save(){if(!this.has_save())return;const t=JSON.parse(localStorage.getItem("save"));CURRENT_COLORS=t.current_colors,setup_colors(!1),ACHIEVEMENTS_STATUS=t.achievements_status,ACHIEVEMENTS_UNLOCKED=t.achievements_unlocked,VOLUME=t.volume,team=[];for(let e=0;e<t.team.length;e++)team[e]=new Char(PLAYER_TEAM,t.team[e])}next_state(t){if((4===this.state||5===this.state)&&3===t)return this.screen[3].pause=!1,void(this.state=t);switch(this.state){case 9:setup_achievements();break;case 3:this.screen[3].winner===PLAYER_TEAM&&this.screen[3].wave===WAVE_QUANTITY&&(this.popup=this.screen[9].verify_achievements(),this.screen[3]=new Battle,upgrades=[]),this.screen[3].winner===ENEMY_TEAM&&(this.screen[3]=new Battle,upgrades=[])}3===t?this.screen[t].reset():2===t&&this.screen[3].setup(),this.screen[t].setup(),this.state=t}}function preload(){COLORS=[{main:color(255,204,0),shadow:color(240,152,22),second:color(255),bullet:color(255,100,100),bullet_complementary:color(255,100,255),dead:color(255,94,56),upgrade:color(184,255,159),team:color(123,176,247)},{main:color(30,30,30),shadow:color(0,0,0),second:color(255),bullet:color(255,100,100),bullet_complementary:color(255,100,255),dead:color(255,94,56),upgrade:color(255,204,0),team:color(100,100,255)},{main:color(200,100,255),shadow:color(140,70,200),second:color(255),bullet:color(80,228,155),bullet_complementary:color(14,105,27),dead:color(255,70,50),upgrade:color(160,255,120),team:color(130,180,255)},{main:color(245,202,195),shadow:color(192,130,156),second:color(255),bullet:color(242,130,130),bullet_complementary:color(132,160,160),dead:color(255,94,56),upgrade:color(255,246,179),team:color(123,176,247)},{main:color(137,216,55),shadow:color(75,150,0),second:color(255),bullet:color(255,130,90),bullet_complementary:color(255,130,255),dead:color(255,90,60),upgrade:color(255,246,179),team:color(150,150,255)}],setup_colors(!1);game=new Game,game.load("/audio","/images","/font")}function setup(){createCanvas(windowWidth,windowHeight,WEBGL),frameRate(60),pixelDensity(1),setAttributes({antialias:!1,depth:!1,premultipliedAlpha:!1}),noSmooth(),curveDetail(3),describe("A game about characters fighting each other."),update_constants(),update_mouse(),SMALL_SCREEN=small_screen(),MOBILE=isMobile(),game.setup()}function draw(){if(SMALL_SCREEN)return push(),background(MAIN_COLOR),text("Screen too small",0,0),void pop();MOBILE||update_mouse(),game.draw()}function mouseClicked(){SMALL_SCREEN||MOBILE||game.mouseClicked()}function mouseMoved(){SMALL_SCREEN||MOBILE||game.mouseMoved()}function touchStarted(){!SMALL_SCREEN&&MOBILE&&(update_mouse(),game.touchStarted())}function touchMoved(){!SMALL_SCREEN&&MOBILE&&(update_mouse(),game.touchMoved())}function touchEnded(){!SMALL_SCREEN&&MOBILE&&(update_mouse(),game.touchEnded())}function windowResized(){resizeCanvas(windowWidth,windowHeight),update_constants(),game.resize(),SMALL_SCREEN=!!small_screen()}function update_constants(){WINDOW_TOP=-height/2,WINDOW_BOTTOM=height/2,WINDOW_LEFT=-width/2,WINDOW_RIGHT=width/2}function update_mouse(){MOUSE_X=mouseX+WINDOW_LEFT,MOUSE_Y=mouseY+WINDOW_TOP}